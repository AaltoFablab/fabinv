<!DOCTYPE html>
<html lang="en">
  <head>

    <meta charset="utf-8">
    <title>Inventory</title>
    <meta name="description" content="">
    <meta name="author" content="">

    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/skeleton.css">
    <link rel="stylesheet" href="css/style.css">

    <link rel="icon" type="image/png" href="images/icon2.png">

  </head>
  <body>
    <div class="container" id="zero">
      <div id="header">
        <h3 class="u-full-width" id="headerone" style="color:blue;">
          //Inventory//
        </h3>
      </div>
    <br />
    <div class="five columns" id="search-box">
      <input type="text" name="search" autocomplete="off" id="search" placeholder="Search For Items..."/>
    </div>
    <div class="seven columns" id="color-box">
      ││││││││││││ ││││││││││││
    </div>
    <br />
    <br />
    <br />
      <div class="row" id="one">
        <div class="seven columns" id="two">
          <table class="u-full-width" id="items-table">
            <p id="titled">
              Name, Price (€), Location
            </p>
            <tbody>
            </tbody>
          </table>
        </div>
        <div class="five columns" id="three">
          <div>
            <h3 id="headertwo" style="color:red">
              //Details//
            </h3>
            <p id="detailtext">
              Click on items for details.
            </p>
            <button style="float:right">edit</button>
          </div>
        </div>
      </div>
    </div>
    <!--- Change pathing --->                             <!-------->
    <script src="libraries/jquery-3.4.1.min.js"></script>
    <script>


      $(document).ready(function() {
        
        function processInput(){
            console.log('onetwothree');
        }
        function updateItemTable(data){   //\\//\\UPDATE//\\ITEM//\\TABLE//\\//\\

            $('#items-table').empty();
            data.data.items.forEach(function(element){

                $('#items-table').append('<tr>' +
                '<td class="itemName">' + element.name + '</td>' +
                '<td class="itemPrice">' + element.price + '</td>' +
                '<td class="itemLocationName">' + element.location.name + '</td></tr>');
            });
        }

        $('#search').bind('input propertyChange', function(event){

            if(event.target.value == ''){
                return;
            }
            $.ajax({

                method: 'POST',
                url: 'http://127.0.0.1:5000/graphql',
                contentType: 'application/graphql',
                data: '{items(search:"' +
                    event.target.value +
                    '"){name, price, location{name}}}',
                  success: function(data){
                    updateItemTable(data);
                },
                error: function(xhr, status, error){
                    console.log(status);
                }
            });
        });
        $.ajax({

          type: 'POST',
          url:"/graphql",
          contentType: "application/graphql",
          data: "{items{name,price,location{name}}}",

          success: function(result) {

            console.log(result);
            let items = result.data.items;
            for(var i = 0; i < items.length; i++) {

              console.log(items[i]);

              $("#items-table").append(

                  '<tr data-id="' + items[i].id + '">' +
                  '<td class="itemName">' + items[i].name + '</td>' +
                  '<td class="itemPrice">' + items[i].price + '</td>' +
                  '<td class="itemLocationName">' + items[i].location.name + '</td>' +
                  '</tr>');

              $('#items-table tr').last().click(function(){

                var itemName = $(this).find('.itemName').first().text();
                var itemPrice = $(this).find('.itemPrice').first().text();
                var itemLocationName = $(this).find('.itemLocationName').first().text();
                console.log( itemName, itemPrice, itemLocationName );

                $('#detailtext').html(

                  'Item Name: ' + itemName + '<br><br>' +
                  'Item Price: ' + itemPrice + '<br><br>' +
                  'Item Location: ' + itemLocationName );
              });
            }
          }
        });
      });
    </script>
  </body>
</html>
